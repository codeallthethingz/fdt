<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" type="text/css" />
    <link rel="stylesheet" href="css/main.css" type="text/css" />
</head>

<body>
    <div id="overlay" style="display: none"></div>
    <div data-role="page">
        <div data-role="header">
            <h1>Food Diary <span class="version"></span></h1>
            <button data-role="button" id="buttonLogout" data-icon="false" data-iconpos="false" class="ui-btn-right" style="display:none">logout</button>
            <button data-role="button" id="buttonLogin" data-icon="false" data-iconpos="false" class="ui-btn-right">login</button>
        </div>

        <div data-role="content">
            <form class="ui-filterable">
                <input id="cause" data-type="search" placeholder="What was the thing you just ate / drank?">
            </form>
            <ul id="causeList" data-role="listview" data-filter="true" data-filter-reveal="true" data-input="#cause"></ul>
        </div>

        <div data-role="content">
            <form class="full-width-slider">
                <input class="date-slider" type="range" name="causeDate" id="causeDate" min="0" max="336" value="336">
                <div id="causeDateOutput" class="date-formatted">now</div>
            </form>
        </div>

        <div data-role="content">
            <div id="causeSuccess" style="display:none" class="action action-success">Saved</div>
            <div id="causeFailed" style="display:none" class="action action-error">Failed</div>
            <form>
                <input id="saveCauseButton" type="button" data-icon="cloud" value="Save Cause into the Cloud">
            </form>
        </div>

        <hr>

        <div data-role="content">
            <form class="ui-filterable">
                <input id="effect" data-type="search" placeholder="What was the sympton that happened?">
            </form>
            <ul id="effectList" data-role="listview" data-filter="true" data-filter-reveal="true" data-input="#effect">
            </ul>
        </div>

        <div data-role="content">
            <form class="full-width-slider">
                <input class="date-slider" type="range" name="effectDate" id="effectDate" min="0" max="336" value="336">
                <div id="effectDateOutput" class="date-formatted">now</div>
            </form>
        </div>

        <div data-role="content">
            <form>
                <fieldset data-role="controlgroup" data-type="horizontal">
                    <input type="radio" name="severity" id="severity1" value="1" checked="checked">
                    <label for="severity1">1</label>
                    <input type="radio" name="severity" id="severity2" value="2">
                    <label for="severity2">2</label>
                    <input type="radio" name="severity" id="severity3" value="3">
                    <label for="severity3">3</label>
                    <input type="radio" name="severity" id="severity4" value="4">
                    <label for="severity4">4</label>
                    <input type="radio" name="severity" id="severity5" value="5">
                    <label for="severity5">5</label>
                    <input type="radio" name="severity" id="severity6" value="6">
                    <label for="severity6">6</label>
                    <input type="radio" name="severity" id="severity7" value="7">
                    <label for="severity7">7</label>
                    <input type="radio" name="severity" id="severity8" value="8">
                    <label for="severity8">8</label>
                    <input type="radio" name="severity" id="severity9" value="9">
                    <label for="severity9">9</label>
                    <input type="radio" name="severity" id="severity10" value="10">
                    <label for="severity10">10</label>
                </fieldset>
            </form>
        </div>

        <div data-role="content">
            <div id="effectSuccess" style="display:none" class="action action-success">Saved</div>
            <div id="effectFailed" style="display:none" class="action action-error">Failed</div>
            <form>
                <input id="saveEffectButton" type="button" data-icon="cloud" value="Save Effect into the Cloud">
            </form>
        </div>

    </div>

    <script src="https://cdn.rawgit.com/remy/bind/928c52ce335d6fd2c824b536a97efa460554b9e0/dist/bind.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/app.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>

    <script>
        $(document).bind('pageinit', function() {
            handleClientLoad();
        });
        /* global $ */
        function setupUi() {
            $('.date-slider').on('change', function() {
                updateDateValue(this.id);
            });

            function updateDateValue(selector) {
                var current = new Date();
                var dateValue = getDateValue(selector);
                var day = dateValue.getDay();
                var hour = dateValue.getHours();
                var minutes = dateValue.getMinutes() == 0 ? '00' : dateValue.getMinutes();
                var prefix = current.getDate() == dateValue.getDate() ? 'Today' : current.getDate() - 1 == dateValue.getDate() ? 'Yesterday' : 'Last ' + weekday[day];
                new Date($('#' + selector + 'Output').html(prefix + ' at ' + (hour % 12 === 0 ? 12 : hour % 12) + ':' + minutes + (hour < 12 ? 'am' : 'pm')));
            }

            function getDateValue(selector) {
                var slideValue = $('#' + selector).val();
                var current = new Date();
                return new Date((Math.round(current.getTime() / MINUTE_INCREMENT) * MINUTE_INCREMENT) - ((336 - slideValue) * MINUTE_INCREMENT));
            }

            $('.date-slider').each(function() {
                updateDateValue(this.id);
            });

            $('#saveCauseButton').on('click', function() {
                var cause = $('#cause').val();
                var causeDate = getDateValue('causeDate');
                save('cause', cause, causeDate, -1);
            });
            $('#saveEffectButton').on('click', function() {
                var effect = $('#effect').val();
                var effectDate = getDateValue('effectDate');
                var severity = $('input[name=severity]:checked').val();
                save('effect', effect, effectDate, severity);
            });

        }

        $('#buttonLogout').on('click', function() {
            gapi.auth2.getAuthInstance().signOut().then(function() {
                console.log('User signed out.');
                $('#buttonLogin').show();
                $('#buttonLogout').hide();
            });
        })
        
        $('#buttonLogin').on('click', function() {
            gapi.auth2.getAuthInstance().signIn().then(function() {
                console.log('User signed in.');
            });
        })

        $("#causeList").on("filterablefilter", function(event, ui) {
            ui.items.each(function(index, item) {
                $(item).not('.tracie-tracker').each(function(index, item) {
                    $(item).addClass('tracie-tracker');
                    $(item).on('click', function() {
                        $('#cause').val($(this).text());
                    });
                });
            });
        });

        $("#effectList").on("filterablefilter", function(event, ui) {
            ui.items.each(function(index, item) {
                $(item).not('.tracie-tracker').each(function(index, item) {
                    $(item).addClass('tracie-tracker');
                    $(item).on('click', function() {
                        $('#effect').val($(this).text());
                    });
                });
            });
        });
    </script>


</body>

</html>
